{"ast":null,"code":"import _asyncToGenerator from\"/Users/serhiimaistrenko/react/Kapusta-smart-finance/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/serhiimaistrenko/react/Kapusta-smart-finance/node_modules/@babel/runtime/regenerator/index.js\";import{createAsyncThunk}from'@reduxjs/toolkit';import axios from\"axios\";axios.defaults.baseURL='https://kapusta-backend.goit.global';var setToken=function setToken(token){if(token){return axios.defaults.headers.common.authorization=\"Bearer \".concat(token);}axios.defaults.headers.common.authorization='';};export var register=createAsyncThunk('auth/register',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data,_ref){var dispatch,rejectWithValue,_yield$axios$post,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch=_ref.dispatch,rejectWithValue=_ref.rejectWithValue;_context.prev=1;_context.next=4;return axios.post('auth/register',data);case 4:_yield$axios$post=_context.sent;result=_yield$axios$post.data;if(result.id){dispatch(login(data));}return _context.abrupt(\"return\",result);case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);return _context.abrupt(\"return\",rejectWithValue(_context.t0));case 13:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());export var login=createAsyncThunk('auth/login',/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data,_ref3){var rejectWithValue,_yield$axios$post2,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:rejectWithValue=_ref3.rejectWithValue;_context2.prev=1;_context2.next=4;return axios.post('/auth/login',data);case 4:_yield$axios$post2=_context2.sent;result=_yield$axios$post2.data;setToken(result.accessToken);return _context2.abrupt(\"return\",result);case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](1);return _context2.abrupt(\"return\",rejectWithValue(_context2.t0));case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,10]]);}));return function(_x3,_x4){return _ref4.apply(this,arguments);};}());export var logOut=createAsyncThunk('auth/logout',/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_,thunkAPI){var state,_yield$axios$post3,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:state=thunkAPI.getState();setToken(state.kapusta.accessToken);_context3.prev=2;_context3.next=5;return axios.post('/auth/logout');case 5:_yield$axios$post3=_context3.sent;data=_yield$axios$post3.data;setToken();return _context3.abrupt(\"return\",data);case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](2);console.log(_context3.t0);case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[2,11]]);}));return function(_x5,_x6){return _ref5.apply(this,arguments);};}());export var refresh=createAsyncThunk('auth/refresh',/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_,thunkAPI){var state,sid,_yield$axios$post4,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:state=thunkAPI.getState();sid=state.kapusta.sid;if(!(state.kapusta.refreshToken===null)){_context4.next=4;break;}return _context4.abrupt(\"return\",state);case 4:setToken(state.kapusta.refreshToken);_context4.prev=5;_context4.next=8;return axios.post('/auth/refresh',{sid:sid});case 8:_yield$axios$post4=_context4.sent;data=_yield$axios$post4.data;return _context4.abrupt(\"return\",data);case 13:_context4.prev=13;_context4.t0=_context4[\"catch\"](5);console.log(_context4.t0);case 16:case\"end\":return _context4.stop();}}},_callee4,null,[[5,13]]);}));return function(_x7,_x8){return _ref6.apply(this,arguments);};}());","map":{"version":3,"names":["createAsyncThunk","axios","defaults","baseURL","setToken","token","headers","common","authorization","register","data","dispatch","rejectWithValue","post","result","id","login","accessToken","logOut","_","thunkAPI","state","getState","kapusta","console","log","refresh","sid","refreshToken"],"sources":["/Users/serhiimaistrenko/react/Kapusta-smart-finance/src/Redux/authOperaions.js"],"sourcesContent":["import { createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from \"axios\";\naxios.defaults.baseURL = 'https://kapusta-backend.goit.global';\nconst setToken = token => {\n    if (token) {\n        return axios.defaults.headers.common.authorization = `Bearer ${token}`;\n    }\n    axios.defaults.headers.common.authorization = '';\n};\nexport const register = createAsyncThunk('auth/register', async (data, { dispatch, rejectWithValue }) => {\n    try {\n        const { data: result } = await axios.post('auth/register', data);\n        if (result.id) {\n            dispatch(login(data));\n        }\n        return result;\n    } catch (error) {\n\n        return rejectWithValue(error);\n    }\n})\nexport const login = createAsyncThunk('auth/login', async (data, { rejectWithValue }) => {\n    try {\n        const { data: result } = await axios.post('/auth/login', data);\n        setToken(result.accessToken);\n        return result;\n    } catch (error) {\n        return rejectWithValue(error);\n    }\n})\nexport const logOut = createAsyncThunk('auth/logout', async (_, thunkAPI) => {\n    const state = thunkAPI.getState();\n    setToken(state.kapusta.accessToken);\n    try {\n        const { data } = await axios.post('/auth/logout');\n        setToken();\n        return data;\n    } catch (error) {\n        console.log(error);\n\n\n    }\n})\nexport const refresh = createAsyncThunk('auth/refresh', async (_, thunkAPI) => {\n    const state = thunkAPI.getState();\n    const sid = state.kapusta.sid;\n    if (state.kapusta.refreshToken === null) return state;\n    setToken(state.kapusta.refreshToken);\n    try {\n        const { data } = await axios.post('/auth/refresh', { sid })\n        return data;\n    } catch (error) {\n        console.log(error);\n    }\n})"],"mappings":"qRAAA,OAASA,gBAAgB,KAAQ,kBAAkB,CACnD,MAAOC,MAAK,KAAM,OAAO,CACzBA,KAAK,CAACC,QAAQ,CAACC,OAAO,CAAG,qCAAqC,CAC9D,GAAMC,SAAQ,CAAG,QAAXA,SAAQ,CAAGC,KAAK,CAAI,CACtB,GAAIA,KAAK,CAAE,CACP,MAAOJ,MAAK,CAACC,QAAQ,CAACI,OAAO,CAACC,MAAM,CAACC,aAAa,kBAAaH,KAAK,CAAE,CAC1E,CACAJ,KAAK,CAACC,QAAQ,CAACI,OAAO,CAACC,MAAM,CAACC,aAAa,CAAG,EAAE,CACpD,CAAC,CACD,MAAO,IAAMC,SAAQ,CAAGT,gBAAgB,CAAC,eAAe,2FAAE,iBAAOU,IAAI,6KAAIC,QAAQ,MAARA,QAAQ,CAAEC,eAAe,MAAfA,eAAe,uCAE3DX,MAAK,CAACY,IAAI,CAAC,eAAe,CAAEH,IAAI,CAAC,wCAAlDI,MAAM,mBAAZJ,IAAI,CACZ,GAAII,MAAM,CAACC,EAAE,CAAE,CACXJ,QAAQ,CAACK,KAAK,CAACN,IAAI,CAAC,CAAC,CACzB,CAAC,gCACMI,MAAM,4FAGNF,eAAe,aAAO,uEAEpC,oEAAC,CACF,MAAO,IAAMI,MAAK,CAAGhB,gBAAgB,CAAC,YAAY,2FAAE,kBAAOU,IAAI,0KAAIE,eAAe,OAAfA,eAAe,yCAE3CX,MAAK,CAACY,IAAI,CAAC,aAAa,CAAEH,IAAI,CAAC,0CAAhDI,MAAM,oBAAZJ,IAAI,CACZN,QAAQ,CAACU,MAAM,CAACG,WAAW,CAAC,CAAC,iCACtBH,MAAM,gGAENF,eAAe,cAAO,yEAEpC,qEAAC,CACF,MAAO,IAAMM,OAAM,CAAGlB,gBAAgB,CAAC,aAAa,2FAAE,kBAAOmB,CAAC,CAAEC,QAAQ,wJAC9DC,KAAK,CAAGD,QAAQ,CAACE,QAAQ,EAAE,CACjClB,QAAQ,CAACiB,KAAK,CAACE,OAAO,CAACN,WAAW,CAAC,CAAC,wCAEThB,MAAK,CAACY,IAAI,CAAC,cAAc,CAAC,0CAAzCH,IAAI,oBAAJA,IAAI,CACZN,QAAQ,EAAE,CAAC,iCACJM,IAAI,+DAEXc,OAAO,CAACC,GAAG,cAAO,CAAC,uEAI1B,qEAAC,CACF,MAAO,IAAMC,QAAO,CAAG1B,gBAAgB,CAAC,cAAc,2FAAE,kBAAOmB,CAAC,CAAEC,QAAQ,4JAChEC,KAAK,CAAGD,QAAQ,CAACE,QAAQ,EAAE,CAC3BK,GAAG,CAAGN,KAAK,CAACE,OAAO,CAACI,GAAG,MACzBN,KAAK,CAACE,OAAO,CAACK,YAAY,GAAK,IAAI,4DAASP,KAAK,SACrDjB,QAAQ,CAACiB,KAAK,CAACE,OAAO,CAACK,YAAY,CAAC,CAAC,wCAEV3B,MAAK,CAACY,IAAI,CAAC,eAAe,CAAE,CAAEc,GAAG,CAAHA,GAAI,CAAC,CAAC,0CAAnDjB,IAAI,oBAAJA,IAAI,kCACLA,IAAI,+DAEXc,OAAO,CAACC,GAAG,cAAO,CAAC,uEAE1B,qEAAC"},"metadata":{},"sourceType":"module"}